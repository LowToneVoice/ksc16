\documentclass[dvipdfmx]{jsarticle}
\usepackage{amsmath,amssymb}
\usepackage[dvipdfmx]{graphicx}
\usepackage{physics}
% table
\usepackage{booktabs}
% unit and No.
\usepackage{siunitx}
% calligraphy
\usepackage{bm}
\usepackage{mathrsfs}
% hyperlink
\usepackage{hyperref}
\usepackage{pxjahyper}
% displaying codes
\usepackage{listings}
% page rotation
\usepackage{lscape}
% subcaption of fig.
\usepackage{subcaption}
% tikz
\usepackage{tikz}
\usepackage{circuitikz}
\usetikzlibrary{intersections,calc,arrows.meta}
\usetikzlibrary{circuits.logic.US}
\usetikzlibrary{positioning, fit}
% eq, fig, table number
\makeatletter
    % reference to <section>.<ref>
    \renewcommand{\theequation}{\thesection.\arabic{equation}}
    \renewcommand{\thefigure}{\thesection.\arabic{figure}}
    \renewcommand{\thetable}{\thesection.\arabic{table}}

    % reset references when renew section
    \@addtoreset{equation}{section}
    \@addtoreset{figure}{section}
    \@addtoreset{table}{section}

    % for appendix
    % cf. https://geniusium.hatenablog.com/entry/2022/02/08/074315
    \renewcommand{\appendix}{\par
        % renew section No.
        \setcounter{section}{0}
        \setcounter{subsection}{0}
        \gdef\presectionname{\appendixname}
        \gdef\postsectionname{}
        \gdef\thesection{\presectionname\@Alph\c@section\postsectionname}
        \gdef\thesubsection{\@Alph\c@section.\@arabic\c@subsection}
        % reference styles
        \renewcommand{\theequation}{\@Alph\c@section.\arabic{equation}}%
        \renewcommand{\thefigure}{\@Alph\c@section.\arabic{figure}}%
        \renewcommand{\thetable}{\@Alph\c@section.\arabic{table}}%
    }
\makeatother
% displaying codes
% cf. https://turgure.hatenablog.com/entry/2016/08/19/183501
\lstnewenvironment{mylisting}[1][]
    {\lstset{
        breaklines=true,
        frame=single,
        basicstyle=\ttfamily,
        numbers=left,
        numbersep=10pt,
        tabsize=4,
        extendedchars=true,
        xleftmargin=24pt,
        framexleftmargin=24pt,
        #1
    }
}{}
% no page no.
\pagestyle{empty}

\title{宇宙線観察から学ぶ粒子の崩壊とスピン回転
}
\begin{document}
\maketitle

\section{理論}

\subsection{ミュオンの生成}
\label{sec: theory: generation of muon}

ミュオン$\mu^-$は第2世代の荷電レプトンであり、地表に到達する2次宇宙線の大部分を占める。
% 文献裏ドリほしい
電荷は$\pm1$, スピン$1/2$, 質量$\SI[]{105.658 3715(35)}[]{\MeV}$で電子の約200倍あり, 寿命は$\SI{2.1969811(22)}{\micro\second}$である。
% 文献裏ドリほしい
2次宇宙線のミュオンは主に荷電パイオンの崩壊によって生じる。
1次宇宙線の陽子が大気上層で
\begin{align*}
    &p+p\to p+n+\pi^+
    \\
    &p+n\to p+p+\pi^-
    \\
    &p+n\to p+n+\pi^++\pi^-
\end{align*}
の反応を起こしてパイオンが生じ、
\begin{align*}
    &\pi^+\to\mu^++\nu_\mu
    \\
    &\pi^-\to\mu^-+\bar{\nu}_\mu
\end{align*}
と崩壊する。
% 以下全ての反応について、ファインマンダイアグラム描けそうだったら書いて欲しい。必要そうならの話だけど。

ニュートリノのヘリシティは負、反ニュートリノは正であるから、角運動量保存よりパイオン静止系にて$\mu^+$のスピンは運動量と逆、$\mu^-$は同じ向きとなる。
パイオンの崩壊は主に電磁シャワー内部で生じることを考慮すると、実験室系にて地表に降り注ぐ向きの運動量が大きい$\mu^+$はスピンが下向き、$\mu^-$はスピンが上向きになる割合が多くなると考えられる。
% 定量的なことを言いたい
% 図が欲しい気もする


\subsection{ミュオンの崩壊}
\label{sec: theory: decay of muon}

宇宙線ミュオンは地表に降り注ぐ間は固有時間がほとんど進まないが、
% 文献ほしい
資料にトラップされると平均寿命$\SI{2.1969811(22)}{\micro\second}$で崩壊し電子または陽電子を放出する。
\begin{align*}
    &\mu^+\to e^++\nu_e+\bar{\nu}_\mu
    \\
    &\mu^-\to e^-+\bar{\nu}_e+\nu_\mu
\end{align*}
Fermiの黄金則を使えばエネルギーとスピンに依存する(陽)電子の放出方向の分布が計算でき、以下の式で表される。
% 文献ほしい
\begin{equation*}
    \dv{N(v,|b|,t)}{t}
    =
    N_0\frac{\lambda}{2\pi}y^2(3-2y)
    \qty(
        1+\frac{2y-1}{3-2y}P_z\cos\theta
    )
    e^{-\gamma t}\dd{y}\dd{\Omega}
\end{equation*}
積分して、
\begin{equation*}
    N=
    \iint N_0\frac{\lambda}{4\pi}
    A_0(1+aP\cos\theta)e^{-\gamma t}
    \dd{y}\dd{\Omega}
\end{equation*}
を得る。
% 図ほしい。できれば計算で求めたやつ。
すなわち、$\mu^+$はスピンと同じ向きに陽電子を、$\mu^-$はスピンと逆向きに電子を出しやすい。

\ref{sec: theory: generation of muon}を合わせて踏まえると、地表に降り注ぐミュオンのうち運動量の大きいものは上向きに、運動量の小さいものは下向きに(陽)電子を多く放出する。


\subsection{負ミュオンの原子核捕獲}

一部の$\mu^-$は物質中に侵入すると原子核のCoulombポテンシャルにとらわれミュオン原子を形成する。
この$\mu^-$は特性X線やオージェ電子を放出して次第に低準位へ遷移し、やがて原子核へ落ち込む。
原子核にて陽子と弱い相互作用をすることで中性子を放出する。
\begin{equation*}
    \mu^-+p\to n+\nu_\mu
\end{equation*}

(陽)電子だけでなく中性子も検出する装置を使うと、$\mu^-$の減衰比には通常の崩壊に加えてこの原子核捕獲の確率も加わるため、見かけの寿命は$\mu^+$に比べて短くなる。
寿命変化は原子核に依存し、今回使用した試料に含まれる元素では表\ref{table: theory: life of muon}のようになる\cite{Ito Kaji Tabata Yoshiwara}。

% もうちょい桁数ほしい
\begin{table}
    \centering
    \caption{各元素における$\mu^-$の寿命変化}
    \begin{tabular}{lrr}
        \toprule
        元素 & 文献値$[\unit{\micro\second}]$
        \\
        \midrule
        Cu & 0.16
        \\
        Al & 0.86
        \\
        Ca & 0.33
        \\
        C & 2.04
        \\
        O & 0.81
        \\
        \bottomrule
    \end{tabular}
    \label{table: theory: life of muon}
\end{table}

% 元素を混ぜた時の寿命についても書きたい

ミュオンが試料に停止してから崩壊して(陽)電子を出すまでの時間$t$を計測し、$(t,t+\Delta t)$のカウント$N(t)$をヒストグラムで集計すれば、$\mu^-$の寿命変化及び計測のバックグラウンド$BG$を反映して以下の式が成立すると考えられる。
\begin{equation}
    \label{eq: N of t considering different tau and BG}
    N(t)
    =
    N_0^+e^{-t/\tau_+}
    +
    N_0^-e^{-t/\tau_-}
    +
    BG
\end{equation}


\subsection{ミュオンのスピン偏極検出}

\ref{sec: theory: decay of muon}に基づけば、磁場をかけない状態で運動量の比較的大きいミュオンを多くトラップする試料を上下2つの検出器で挟むと上側で(陽)電子をより多く検出する。
しかし上下の検出数の差がスピン偏極によるものなのか検出器の特性によるものなのかを判断することは難しい。
% 実際の実験装置とは別に試料上下に検出器を置いている図が欲しい。概念的なものなのでTはいらない。
そこで偏極の検出では一般にLarmor歳差運動を用いる。
磁気回転比$\gamma$のミュオンスピンに磁場$\bm{B}$がかかると、
\begin{equation}
    \label{eq: Larmor precession}
    \bm{\omega}=\gamma\bm{B}
\end{equation}
の角速度で歳差運動する。

上下の検出器でのカウントをそれぞれ$N_U, N_D$とする。
\ref{sec: theory: decay of muon}で述べた$\mu^-$の原子核捕獲も考慮すると、以下の式が成り立つと考えられる。
\begin{equation}
    \label{eq: N under Larmor}
    \begin{split}
        N_U
        &=
        N_{U0}^+(1+AP^+\cos\omega t)e^{-t/\tau_+}
        +
        N_{U0}^-(1+AP^-\cos\omega t)e^{-t/\tau_-}
        +
        BG_D
        \\
        N_D
        &=
        N_{D0}^+(1-AP^+\cos\omega t)e^{-t/\tau_+}
        +
        N_{D0}^-(1-AP^-\cos\omega t)e^{-t/\tau_-}
        +
        BG_D
    \end{split}
\end{equation}
ここで$\tau_-$は原子核捕獲のため一般に小さく、$\mu^-$は試料に侵入すると周囲の電子との間で相互作用してスピン偏極が破れる。
% 文献ほしい
このため$t\gg\tau_-$として\eqref{eq: N under Larmor}各式の第2項は無視できる。
$N_U'=N_U-BG_U, N_D'=N_D-BG_D$及び実数$\alpha$を使って、
\begin{equation}
    \label{eq: asymmetry}
    \mathscr{A}
    =
    \frac{\alpha N_U'-N_D'}{\alpha N_U'+N_D'}
    =
    \frac{(\alpha N_{U0}^+-N_{D0}^+)+(\alpha N_{U0}^++N_{D0}^+)AP^+\cos\omega t}{(\alpha N_{U0}^++N_{D0}^+)+(\alpha N_{U0}^+-N_{D0}^+)AP^+\cos\omega t}
\end{equation}
と表される非対称度は、$\alpha N_{U0}^+-N_{D0}^+=0$なる$\alpha$にて角振動数$\omega$の三角関数となる。


\section{実験・解析方法}

本演習では、
\begin{itemize}
    \item ミュオンの寿命
    \item 負ミュオンの寿命変化
    \item スピン偏極
\end{itemize}
の測定を目的とする。

\subsection{寿命測定}
\label{sec: method: life}

図\ref{fig: PSc, PMT position and muon path}に示すように試料を上下からプラスチックシンチレータ(PSc)で挟み光電子増倍管(PMT)に接続する。
試料にはCu, Alの板を重ね合わせたものと、大理石の板とを使った。
PSc+PMTは上層から順にT,U,Dとし、各層でシンチレーション光を別々に検出できるようにする。

宇宙線及び崩壊粒子
\footnote{$\mu^-$の原子核捕獲で生じる中性子も速度が〜となってPScの検出下限〜を上回る。}
% 文献ほしい。崩壊中性子の速度とPSc内部の光速
の飛程を考慮すると、以下の事象が考えられる。
\renewcommand{\theenumi}{(\alph{enumi})}
\begin{enumerate}
    \item \label{item: pass through}粒子が試料を通過
    \item \label{item: decay into U}崩壊時に粒子を上方へ放出
    \item \label{item: decay into D}崩壊時に粒子を下方へ放出
\end{enumerate}
事象\ref{item: pass through}ではTUD全てのPSc+PMTが反応するが、事象\ref{item: decay into U}, \ref{item: decay into D}ではまずTUが反応しDが反応しない。
その後時間を置いて粒子が崩壊すると、事象\ref{item: decay into U}ではUが、事象\ref{item: decay into D}ではDが反応する。

各事象を弁別するためおおよそ図\ref{fig: circuit easy}に示す論理回路を組む。
\footnote{実際に構成した論理回路は\ref{sec: logic circuit}を参照。2種類の試料を同時に測定するため、入出力が2系統あるのに加えて制御系統が複雑になっている。}
左端のandゲートでミュオンが試料に停止したか検出し、停止すればgate generatorを作動、時間測定を開始する。
このgate generatorが作動している間にUまたはDで信号を検出すれば、崩壊によって粒子が放出されたものとして同図右側のand gateで測定を止める。

Cu, Al及び及び大理石それぞれの試料で計測は$\SI{18}{\hour}, \SI{51}{\hour}$にわたって行った。

\begin{figure}
    \centering
    \begin{tabular}[]{ccc}
        \begin{minipage}[t]{0.3\hsize}
            \input{../img/models/pass-through.tex}
            \subcaption{試料を通過する場合}
        \end{minipage}
        &
        \begin{minipage}[t]{0.3\hsize}
            \input{../img/models/decay-intoU.tex}
            \subcaption{崩壊してUに電子を飛ばす場合}
        \end{minipage}
        &
        \begin{minipage}[t]{0.3\hsize}
            \input{../img/models/decay-intoD.tex}
            \subcaption{崩壊してDに電子を飛ばす場合}
        \end{minipage}
    \end{tabular}
    \caption{PSc+PMTの配置と粒子の飛程。着色部が試料を表す。}
    \label{fig: PSc, PMT position and muon path}
\end{figure}

\begin{figure}
    \centering
    \input{../img/circuits/circiut-easy.tex}
    \caption{回路の概要。GGはgate generatorを表し、入力から所定の時間(本演習では$\SI[]{20}[]{\micro\second}$)出力を続ける。}
    \label{fig: circuit easy}
\end{figure}

U, D両側で測定したカウント$N_U, N_D$を合計して、時間を横軸としてヒストグラムにする。
% rebin 100 って何ns?
$N_U+N_D$の分布は\eqref{eq: N of t considering different tau and BG}に従うはずであるから、この式によってフィッティングし寿命$\tau_+, \tau_-$を求める。


\subsection{スピン偏極測定}

\ref{sec: method: life}でのCu, Alの実験と同様にセットアップした上で、ソレノイドコイルによって水平に磁場を印加、崩壊時間を測定する。

解析にあたっては、まず上下別々にヒストグラムを描いて
\begin{equation}
    \label{eq: method: rough fitting of spin polarization by exp}
    \begin{split}
        &N_U(t)=N_U^0e^{-t/\tau_U}+BG_U
        \\
        &N_D(t)=N_D^0e^{-t/\tau_D}+BG_D
    \end{split}
\end{equation}
でフィッティングする。
得られたバックグラウンドを除いて$N_U'=N_U-BG_U, N_D'=N_D-BG_D$とし、$\alpha$を変えて非対称度\eqref{eq: asymmetry}を計算する。
ただし時間原点を揃える必要があるため、
\begin{equation}
    \label{eq: method: fit asymmetry}
    \mathscr{A}(\alpha,t_{offset})
    =
    \frac{\alpha N_D'(t+t_{offset})-N_U'(t)}{\alpha N_D'(t+t_{offset})+N_U'(t)}
\end{equation}
の$\cos$によるフィッティングが最適なものを探す。
% alphaっていくつおきに変えたっけ？
各$\alpha$に対して$\mathscr{A}$を$A\cos(2\pi ft)$でフィッティングし、このフィッティングの$\chi^2$の上側累積確率が低くなる$\alpha$における$f$を振動数の測定値とする。

検証のため測定値$f$と\eqref{eq: Larmor precession}から磁場の強さ$B$を逆算して、ソレノイドコイルの設計上期待される値$B_{design}=\SI{20}{\milli\tesla}$と比較する。


\section{結果・考察}

\subsection{ミュオンの寿命}

測定データを図\ref{fig: result: CaCO3}に掲げる。
フィッティングした曲線に基づき、それぞれの試料におけるミュオンの寿命は表\ref{table: result: life}のとおりになる。

\begin{figure}
    \centering
    \includegraphics[width=8cm]{../analysis/Life/CaCO3for51h.pdf}
    \caption{大理石}
    \label{fig: result: CaCO3}
\end{figure}

\begin{table}
    \centering
    \caption{$\mu^\pm$の寿命測定結果}
    \begin{tabular}{llrr}
        \toprule
        試料 & 粒子 & 寿命$[\unit{\micro\second}]$ & 文献値$[\unit{\micro\second}]$
        \\
        \midrule
        Cu, Al & $\mu^+$ & & 2.20
        \\
         & $\mu^-$ & & Cu: 0.16, Al: 0.86
        \\
        大理石 & $\mu^+$ & 2.20 & 2.20
        \\
         & $\mu^-$ & 0.84 & Ca: 0.33, C: 2.04, O: 0.81
        \\
        \bottomrule
    \end{tabular}
    \label{table: result: life}
\end{table}

% 考察。特に負ミュオン

\subsection{スピン偏極}

測定結果に\eqref{eq: method: rough fitting of spin polarization by exp}でフィッティングしたものを図に掲げる。
磁場をかけることでカウントは\eqref{eq: N under Larmor}に従うはずであり\eqref{eq: method: rough fitting of spin polarization by exp}によるフィッティングは本来妥当でないが、この操作はバックグラウンドを差し引くためのものなので、$BG_U$の標準偏差及び$\chi^2$の上側累積確率などフィッティングの信頼性は特に留意しない。
各変数は表\ref{table: result: parameters of result with B fit with exp}のようになる。

\begin{table}
    \centering
    \caption{\eqref{eq: method: rough fitting of spin polarization by exp}によってフィッティングしたときの変数値}
    \begin{tabular}[]{lrr}
        \toprule
        $N_U^0$ & $4.63817e+02\:\pm8.72257e+00$
        \\
        $\tau_U$ & $2.07050e+03\:\pm3.18642e+01$
        \\
        $BG_U$ & $6.39559e+00\:\pm2.74083e-01$
        \\
        \midrule
        $N_D^0$ & $2.14776e+02\:\pm6.68531e+00$
        \\
        $\tau_D$ & $2.00158e+03\:\pm5.62010e+01$
        \\
        $BG_D$ & $8.27831e+00\:\pm2.91137e-01$
        \\
        \bottomrule
    \end{tabular}
    \label{table: result: parameters of result with B fit with exp}
\end{table}

次いで\eqref{eq: asymmetry}が適当な$\alpha$で$\cos\omega t$に比例する形を取ることを踏まえ、$\alpha$を調節して

この際、UとDで時間原点が揃うように


\appendix


\section{論理回路}
\label{sec: logic circuit}

実験で実際に用いたNIMモジュールの回路を図\ref{fig: full circuit}に掲げる。
主にCu, Alからの信号の入力部(Cu, Al)、大理石からの入力部($\mathrm{CaCO_3}$)、制御部(GATES)、出力部(OUTPUTS)に大別できる。

入力はTUD各層それぞれ3組のPSc+PMTから引いている。
それぞれT1, T2, T3, U1, ...と番号を振っている。
Cu, AlのTに描いたようなor接続をCu, AlのU以下全ての入力端子でとっているが、簡単のためCu, AlのT以外は省略した。
なお、このor接続以前でdelayを置いているのはCu, AlのTのみである。

制御部GATESはCu, Alと大理石の信号が干渉しないようにスイッチの役割を果たす。
具体的には、Cu, Al側のGGが起動している間は大理石の信号が入ってもstopと判定しない。
逆もまた然りである。

DAQ-PCでは短時間に複数のstart信号を受けたとき最初の信号のみを使用し、それ以降の信号は無視する。

\begin{landscape}
    \begin{figure}
        \centering
        \input{../img/circuits/circuit.tex}
        \caption{実験で用いた論理回路}
        \label{fig: full circuit}
    \end{figure}
\end{landscape}


\section{解析コード}

ここでは解析に用いたコードの概要を示す。
変数の宣言やヒストグラムの取得などは省略しているため、表示の通りに実装しても作動しない。
実際に解析で使用したものは\url{https://github.com/LowToneVoice/ksc16/tree/main/group7/analysis}を参照のこと。
また測定データを\url{https://github.com/LowToneVoice/ksc16/tree/main/group7/data}に置いている。
% 置いとくならこのセクションいらない？

\subsection{寿命測定}

\begin{mylisting}[language=c++, caption=life.C]
void life()
{
    // sum of hists
    hu->Add(hd);
    // configure bin of hist
    hu->Rebin(100);
    // max and min of axis
    hu->GetXaxis()->SetRangeUser(0, 20000);
    hu->GetYaxis()->SetRangeUser(0.1, 300);
    hu->Draw();

    // fitting curve
    TF1 *f1 = new TF1("f1", "[ 0 ] * exp( -(x / [ 1 ])) + [ 2 ] * exp( -(x / [ 3 ])) +  [ 4 ] ");
    f1->SetParameters(150, 2000.0, 120, 900.0, 2.0);
    f1->SetParNames("N_{+}", "#tau_{+}", "N_{-}", "#tau_{-}", "BG");
    hu->Fit("f1", "", "", 100, 20000);
    hu->SetLineWidth(2.0);
    // y axis to log scale
    c1->SetLogy();
    // label displayed with the graph
    hu->SetTitle("CaCO3 51h;time [ns];count;");
}
\end{mylisting}

\subsection{スピン偏極測定}
% 各コードで何が出てくるか、どうやって運用するかを記述。
まずexpFit.Cで\eqref{eq: method: rough fitting of spin polarization by exp}のフィッティングを行いバックグラウンドを求める。

\begin{mylisting}[language=c++,caption=expFit.C]
void expFit()
{
    hu->Rebin(100);
    hd->Rebin(100);

    TF1 *fd = new TF1("fu", "[ 0 ] * exp( -(x / [ 1 ]) + [ 2 ]) +  [ 3 ] ");
    TF1 *fd = new TF1("fd", "[ 0 ] * exp( -(x / [ 1 ]) + [ 2 ]) +  [ 3 ] ");
    fu->SetParameters( 200.0, 2000.0, 0.0, 0.0);
    fu->SetParNames("N_U", "#tau_U", "t0_U", "BG_U");
    fd->SetParameters( 100.0, 2000.0, 0.0, 0.0);
    fd->SetParNames("N_D", "#tau_D", "t0_D", "BG_D");
    hu->Fit("fu", "", "", 300, 22000);
    hu->SetLineWidth(2.0);
    hd->Fit("fd", "", "", 300, 22000);
    hd->SetLineWidth(2.0);

    hd->Draw();
    hd->SetLineColor(kRed);
    hd->GetXaxis()->SetRangeUser(0,25000);
    hd->GetYaxis()->SetRangeUser(0.9,500);
    hu->Draw("same");
    hu->GetXaxis()->SetRangeUser(0,25000);
    hu->GetYaxis()->SetRangeUser(0.9,500);
    c1->SetLogy();
}
\end{mylisting}

\begin{mylisting}[language=c++,caption=findPar.C]
void findPar()
{
    TH1D* hu;
    TH1D* hd;
    const char *fp = "4013.root";
    TFile *file = new  TFile(fp);
    file->GetObject("...", hu);
    file->GetObject("...", hd);

    TH1D* h3;
    TH1D* h4;

    TCanvas *c1= new TCanvas("c1","c1", 600, 600);

    // copy the hists
    TH1D* hu_init;
    TH1D* hd_init;
    hu_init = (TH1D*)hu->Clone();
    hd_init = (TH1D*)hd->Clone();

    int i,j,k;
    Double_t erfun;
    Double_t ndf;
    Double_t prob;

    // parameters
    int offset;
    double alpha;

    // BGs
    const double bg_1 = ...;
    const double bg_2 = ...;

    ofstream outputfile_chi2("param_chi2.dat");
    ofstream outputfile_prob("param_prob.dat");
    for(k=0; k < 50; k++){
        for(j=0; j < 40; j++){

            offset = -200 + 10 * j;
            alpha = 0.1 + k * 0.1;

            hu = (TH1D*)hu_init->Clone();
            hd = (TH1D*)hd_init->Clone();

            // move hd left as long as offset
            for(i=0; i < hd->GetXaxis()->GetNbins(); i++){
                if (offset + i < 0){
                    hd->SetBinContent(i, 0);
                }else{
                    hd->SetBinContent(i, (hd_init->GetBinContent(i + offset)));
                }
            }

            // rebin
            hu->Rebin(100);
            hd->Rebin(100);

            // for error evaluation
            hu->Sumw2();
            hd->Sumw2();

            // deleting BGs
            for(i=0; i < hu->GetXaxis()->GetNbins(); i++){
                hu->SetBinContent(i, hu->GetBinContent(i) - bg_1);
            }

            for(i=0; i < hd->GetXaxis()->GetNbins(); i++){
                hd->SetBinContent(i, (hd->GetBinContent(i) - bg_2));
            }


            h3 = (TH1D*)hu->Clone();
            h4 = (TH1D*)hd->Clone();

            //hd times alpha
            for(i=0; i < hd->GetXaxis()->GetNbins(); i++){
                hd->SetBinContent(i, (h4->GetBinContent(i)) * alpha);
                hd->SetBinError(i, (h4->GetBinError(i)) * alpha);
            }

            // D-U/D+U
            h3 = (TH1D*)hu->Clone();
            h4 = (TH1D*)hd->Clone();
            h4->Add(h3, -1);
            hd->Add(hu, 1);
            h4->Divide(hd);

            // fit by cos
            TF1 *f = new TF1("f", "[0]*cos(2*TMath::Pi()*(x - [2])/[1])");
            f->SetParNames("A", "T", "t_offset");
            f->SetParameters(0.1, 3500, 0.0);
            f->SetParLimits(1, 2500, 4500);
            f->SetParLimits(0, 0.01, 0.5);
            f->SetParLimits(2, -500.0, 500.0);
            h4->Fit("f", "", "", 300, 5000);

            // output chi^2
            erfun = h4->GetFunction("f")->GetChisquare();
            ndf = h4->GetFunction("f")->GetNDF();
            prob = h4->GetFunction("f")->GetProb();
            outputfile_chi2 << erfun / ndf << " ";
            outputfile_prob << prob << " ";
        }
        // change the lines of output
        outputfile_chi2 << endl;
        outputfile_prob << endl;
    }
    outputfile_chi2.close();
    outputfile_prob.close();
}
\end{mylisting}

\begin{mylisting}[language=python,caption=plotError.py]
import numpy as np
from matplotlib import pyplot as plt

# define a graph
fig = plt.figure(figsize=(20,5))
# define subgraphs and arrange
ax1 = fig.add_subplot(1,2,1)
ax2 = fig.add_subplot(1,2,2)

# the 1st graph
ax = ax1
with open('param_chi2.dat') as f:
    ar = np.loadtxt(f);

ar = ar[:,:]
ax.set_title(f"chi^2/ndf")
ax.set_xlabel('t_offset')
ax.set_ylabel('alpha')
extent = [
    -200,
    200,
    5.1,
    0.1
]
aspect = abs(300 / 5.0)
im = ax.imshow(
    ar,
    cmap='jet',
    # vmin=0, vmax=100,
    extent=extent,
    aspect=aspect,
)
colorbar = fig.colorbar(im, ax=ax1, label='colorbar')

# 2nd graph
with open('param_prob.dat', "r") as f:
    ar = np.loadtxt(f);

ar = ar[:,:]

ax2.set_title(f"prob")
ax2.set_xlabel('t_offset')
ax2.set_ylabel('alpha')
extent = [
    -200,
    200,
    5.1,
    0.1
]
aspect = abs(300 / 5.0)
im = ax2.imshow(
    ar,
    cmap='jet',
    # vmin=0, vmax=100,
    extent=extent,
    aspect=aspect,
)
colorbar = fig.colorbar(im, ax=ax2, label='colorbar')
plt.grid(True)
# save
# plt.savefig("findparam_wide_5.png")
plt.show()
\end{mylisting}



\begin{thebibliography}{10}
    \bibitem{Ito Kaji Tabata Yoshiwara} 伊藤泰男,鍛冶東海,田畑米穂,吉原賢二,「素粒子の化学」学会出版センター(1985)
\end{thebibliography}
\end{document}
